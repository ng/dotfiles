#!/bin/bash

################################################################################
# Install Script for Dotfiles
################################################################################
#
# Description:
#   This script installs tmux and sets up dotfile symlinks for your development
#   environment. It is optimized for Gitpod (Ubuntu-based Linux).
#
# Usage:
#   ./install
#
# What it does:
#   1. Checks if tmux is installed, and installs it if missing
#   2. Runs makesymlinks to create symlinks for all dotfiles
#
# Requirements:
#   - Ubuntu-based Linux (apt-get package manager)
#   - sudo privileges for package installation
#   - makesymlinks script in the same directory
#
# Environment:
#   Designed for Gitpod, but should work on any Ubuntu-based system
#
################################################################################

set -e  # Exit on error

# Function to print output
print_info() {
    echo "â„¹ï¸  $1"
}

print_warn() {
    echo "âš ï¸  $1"
}

print_error() {
    echo "âŒ $1"
}

# Check if tmux is already installed
if command -v tmux &> /dev/null; then
    TMUX_VERSION=$(tmux -V | awk '{print $2}')
    print_info "âœ… tmux is already installed (version $TMUX_VERSION)"
else
    print_info "ðŸ“¦ tmux is not installed. Installing..."
    
    # Gitpod uses Ubuntu, so we'll use apt-get
    if command -v apt-get &> /dev/null; then
        print_info "ðŸ”„ Updating package list..."
        sudo apt-get update -qq
        
        print_info "ðŸ“¥ Installing tmux..."
        sudo apt-get install -y tmux
    else
        print_error "apt-get not found. This script is designed for Gitpod (Ubuntu-based)"
        exit 1
    fi
    
    # Verify installation
    if command -v tmux &> /dev/null; then
        TMUX_VERSION=$(tmux -V | awk '{print $2}')
        print_info "ðŸŽ‰ Successfully installed tmux (version $TMUX_VERSION)"
    else
        print_error "Installation completed but tmux command not found"
        exit 1
    fi
fi

# Run makesymlinks to set up dotfiles
print_info "ðŸ”— Setting up symlinks..."
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
if [ -f "$SCRIPT_DIR/makesymlinks" ]; then
    bash "$SCRIPT_DIR/makesymlinks"
else
    print_error "makesymlinks script not found at $SCRIPT_DIR/makesymlinks"
    exit 1
fi
